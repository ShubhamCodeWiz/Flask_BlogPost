{% extends "base.html" %}

{% block title %}
view_post
{% endblock %}

{% block body %}
    <h1>{{ post.title }}</h1>
    
    <div>
        <span>By: {{ post.owner.username }} on {{ post.created_at.strftime('%I:%M %p on %B %d, %Y') }}</span>
        
        {% if current_user.is_authenticated and current_user != post.owner %}
            {% if current_user in post.owner.followers %}
                <a href="{{ url_for('unfollow', username=post.owner.username) }}">Unfollow</a>
            {% else %}
                <a href="{{ url_for('follow', username=post.owner.username) }}">Follow</a>
            {% endif %}
        {% endif %}
        </div>
    
    {% if post.owner == current_user %}
        <div>
            <a href="{{ url_for('edit_post', post_id=post.id) }}">Edit Post</a>
            
            <form action="{{ url_for('delete_post', post_id=post.id) }}" method="POST" style="display:inline;">
                <input type="submit" value="Delete Post" onclick="return confirm('Are you sure you want to delete this post?');">
            </form>
        </div>
    {% endif %}

    <hr>
    
    <p>{{ post.body | safe }}</p>

 <h3>Comments</h3>

    {% if current_user.is_authenticated %}
        <form method="POST" novalidate>
            {{ form.hidden_tag() }}
            <p>
                {{ form.body.label }}<br>
                {{ form.body(rows=4, cols=50) }}
                {% for error in form.body.errors %}<span>{{ error }}</span>{% endfor %}
            </p>
            <p>{{ form.submit() }}</p>
        </form>
    {% else %}
        <p>You must be <a href="{{ url_for('login', next=request.path) }}">logged in</a> to comment.</p>
    {% endif %}

    {% for comment in post.comments %}
        <article>
            <p>
                <strong>{{ comment.author.username }}</strong> 
                <small>on {{ comment.created_at.strftime('%I:%M %p on %B %d, %Y') }}</small>
            </p>
            <p>{{ comment.body }}</p>
        </article>
    {% else %}
        <p>No comments yet. Be the first to comment!</p>
    {% endfor %}
{% endblock %}
